== Running Vulnerable version ==

In order to run 'vulnerability_examle' you must do it in a docker container, with glibc 2.32

1 - Open Docker Desktop

2 - In your IDE of choice, type in the terminal: docker images
If there is an image named cve-2022-23218_cwe-120_image, skip to step 4, else continue to step 3.

3 - Type in the terminal: docker build -f Dockerfile.vuln -t cve-2022-23218_cwe-120_image . 

4 - In the terminal type: docker run --rm -it --privileged cve-2022-23218_cwe-120_image
If it takes too long, cancel, restart docker, and try again. The terminal should look something like this:

[root@56b80ca79b29 /]# 

if you then insert ls, you should see the code file 'vulnerability_example.c'

5 - Check glibc version with: ldd --version
The following message should appear:

ldd (GNU libc) 2.32  
Copyright (C) 2020 Free Software Foundation, Inc.
This is free software; see the source for copying conditions.  There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
Written by Roland McGrath and Ulrich Drepper.

6 - Compile the file with: gcc -fsanitize=address -g -I/usr/include/tirpc -o vuln vulnerability_example.c -Wl,--rpath=/opt/glibc-2.32/lib -ltirpc -pthread -lrt

Run with: LSAN_OPTIONS=verbosity=1:log_threads=1 ./vuln

NOTE: after running it once, you need to restart the container (step 7 and step 4)

You should see a message in the terminal indicating a memory leak (buffer overflow) similar to this:

=================================================================
==22==ERROR: LeakSanitizer: detected memory leaks

Direct leak of 110 byte(s) in 1 object(s) allocated from:
    #0 0x76d52e0d536f in __interceptor_malloc (/lib64/libasan.so.6+0xab36f)
    #1 0x76d52e00ee85 in svcunix_create (/lib64/libtirpc.so.3+0x14e85)

7 - To quit docker insert: exit


== Running Patched version ==

1 - in your machine:
sudo apt update
sudo apt install libtirpc-dev

2 - compile with:
gcc -o vuln vulnerability_example.c \
    -I/usr/include/tirpc \
    -ltirpc -pthread -lrt

3 - run with: ./vuln

you should see:

svcunix_create failed: Operation not supported
errno: 95