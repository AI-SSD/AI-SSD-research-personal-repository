FROM fedora:33

# Install build tools and dependencies
RUN dnf install -y gcc make wget tar bison gawk diffutils texinfo \
    rpcgen glibc-static rpcbind patch \
    libtirpc libtirpc-devel gcc libasan

# Set working directory
WORKDIR /root

# Download glibc 2.32
RUN wget http://ftp.gnu.org/gnu/libc/glibc-2.32.tar.gz && \
    tar -xf glibc-2.32.tar.gz

# Build glibc 2.32 with internal SunRPC enabled
RUN mkdir /root/glibc-build && cd /root/glibc-build && \
    ../glibc-2.32/configure --prefix=/opt/glibc-2.32 \
    --enable-obsolete-rpc && \
    make -j$(nproc) && make install

# Set environment to use new glibc
ENV LD_LIBRARY_PATH=/opt/glibc-2.32/lib
ENV PATH=/opt/glibc-2.32/bin:$PATH

# Copy your vulnerable program
COPY vulnerability_example.c /root/vulnerability_example.c

